<h2>{{'requisitionBatchApproval.approveRequisitions' | message}}</h2>
<div class="openlmis-table-container">
    <saving-indicator class="requisition-indicator" object="vm.requisitions"/>
    <table>
        <thead>
        <tr class="not-bottom">
            <th class="col-sticky is-hidden"></th>
            <th class="col-sticky is-hidden"></th>
            <th colspan="2" ng-repeat="requisition in vm.requisitions track by requisition.id"
                popover="{{requisition.$error}}"
                ng-class="{'requisition-error': requisition.$error}">
                <div> {{requisition.facility.name}} - {{requisition.processingPeriod.name}} </div>
                <div ng-if="requisition.$error">{{ 'requisitionBatchApproval.invalidRequisition' | message }}</div>
            </th>
            <th class="is-hidden"></th>
            <th class="is-hidden"></th>
        </tr>
        <tr>
            <th class="col-sticky"> {{'requisitionBatchApproval.productCode' | message}} </th>
            <th class="col-sticky"> {{'requisitionBatchApproval.product' | message}} </th>
            <th ng-repeat-start="requisition in vm.requisitions track by requisition.id">
               <div> {{'requisitionBatchApproval.approvedQuantity' | message}} </div>
            </th>
            <th ng-repeat-end>
                <div> {{'requisitionBatchApproval.cost' | message}} </div>
            </th>
            <th> {{'requisitionBatchApproval.totalQuantityForAllFacilities' | message}} </th>
            <th> {{'requisitionBatchApproval.totalCostForAllFacilities' | message}} </th>
        </tr>
        </thead>
        <tr ng-repeat="(productId, product) in vm.products track by productId">
            <td> {{product.code}} </td>
            <td> {{product.name}} </td>
            <td ng-repeat-start="requisition in vm.requisitions track by requisition.id" class="numeric">
                <input ng-if="(product.requisitions | contains: requisition.id)"
                       positive-integer
                       ng-model="vm.lineItems[requisition.id][productId].approvedQuantity"
                       ng-change="vm.updateLineItem(vm.lineItems[requisition.id][productId], requisition)"/>
            </td>
            <td class="numeric" ng-repeat-end>
                {{vm.lineItems[requisition.id][productId].totalCost | openlmisCurrency}}
            </td>
            <td class="total-cell numeric"> {{product.totalQuantity}} </td>
            <td class="total-cell numeric"> {{product.totalCost | openlmisCurrency}} </td>
        </tr>
        <tr class="total-row">
            <td>{{'requisitionBatchApproval.total' | message}}</th></td>
            <td></td>
            <td ng-repeat-start="requisition in vm.requisitions track by requisition.id">
            </td>
            <td class="numeric" ng-repeat-end>
                {{requisition.$totalCost | openlmisCurrency}}
            </td>
            <td></td>
            <td class="numeric"> {{vm.totalCost | openlmisCurrency}}</td>
        </tr>
    </table>
</div>
<br /><br />
<div class="openlmis-toolbar button-group" ng-if="vm.requisitions.length">
    <button ng-disabled="vm.isOffline()" ng-click="vm.sync()">{{'requisitionBatchApproval.sync' | message}}</button>
    <div class="button-group primary">
        <button class="primary" ng-disabled="vm.isOffline()" ng-click="vm.approve()">{{'requisitionBatchApproval.approve' | message}}</button>
        <button class="danger" ng-click="vm.revert()">{{'requisitionBatchApproval.revert' | message}}</button>
    </div>
</div>

